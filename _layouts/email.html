{% include header.html %}

<div class="content emailPageHeader">
    <div class="container">
		<h2>{{ page.name }}</h2>
		<b>{{ page.city }}, {{ page.state }}</b><br /> {{ site.email_intro_text | markdownify }}
		<p id="autoopen">{{ site.auto_open_message }}</p>
		<div class='buttons'>
      <a href="javascript:void(0);" onclick="openEmail(EmailClients.MAILTO)">Send email</a>
      <a href="javascript:void(0);" onclick="copyToClipboard(this, `{{ page.permalink }}`, true)">Copy link</a></br>
      <div class='weblinks'>
        Send via webmail
          (<a href="javascript:void(0);" onclick="openEmail(EmailClients.GMAIL)">Gmail</a>,
           <a href="javascript:void(0);" onclick="openEmail(EmailClients.YAHOO)">Yahoo Mail</a>)
      </div>
		</div>
		<p>{{ site.bad_mailto_message }}</p>
    </div>
</div>

<div class="content emailContentSection">
    <div class="container">
        <div class="emailContent">
            <div class="recipients">
                <b>To:</b> {{ page.recipients | join: ',' }}
                <span class="copyToClipboard" onclick="copyToClipboard(this, `{{ page.recipients | join: ',' }}`)">ðŸ”—</span>
			</div>
			{% if page.cc %}
			<div class="recipients">
                <b>CC:</b> {{ page.cc | join: ',' }}
                <span class="copyToClipboard" onclick="copyToClipboard(this, `{{ page.cc | join: ',' }}`)">ðŸ”—</span>
			</div>
			{% endif %}
            <div class="recipients">
                <b>Subject:</b> {{ page.subject }}
                <span class="copyToClipboard" onclick="copyToClipboard(this, `{{ page.subject }}`)">ðŸ”—</span>
			</div>
            <div>
                <b>Message</b> <i>(Don't forget to replace the [x]'s with your information!)</i>
                <span class="copyToClipboard" onclick="copyToClipboard(this, `{{ page.body }}`)">ðŸ”—</span>
                <br /> {{ page.body | markdownify }}
            </div>
        </div>
    </div>
</div>

{% include list.html %}

<script type="text/javascript">
  const EmailClients = {
    MAILTO: 'mailto',
    GMAIL: 'gmail',
    YAHOO: 'yahoo'
  }

	function openEmail(client) {
		const subject = encodeURIComponent(`{{ page.subject }}`.trim());
    const body = encodeURIComponent(`{{ page.body }}`.trim());
    const recipients = `{{ page.recipients | join: ',' }}`;
    const cc = `{{ page.cc | join: ',' }}`;
    const ccText = cc !== null && cc.length > 0 ? `cc=${cc}&` : ``;


    switch(client){
      case EmailClients.MAILTO:
        location.href = `mailto:${recipients}?${ccText}subject=${subject}&body=${body}`;
        break;
      case EmailClients.GMAIL:
        window.open(
          `https://mail.google.com/mail/?view=cm&fs=1&to=${recipients}&${ccText}su=${subject}&body=${body}`,
          '_blank'
        );
        break;
      case EmailClients.YAHOO:
        window.open(
          `https://compose.mail.yahoo.com/?to=${recipients}&${ccText}subj=${subject}&body=${body}`,
          '_blank'
        )
        break;
    }
	}
    $(document).ready(() => {
		const params = getParams(window.location.href)
		if (params.browse !== undefined) {
			$("#autoopen").hide()
			// Automatically updates the URL so if folks try to share, it will auto-open
			window.history.replaceState({}, document.title, `${window.location.origin}{{ page.permalink }}`)
		} else {
			openEmail(EmailClients.MAILTO)
		}
    })
</script>

{% include footer.html %}
